<!doctype html>
<html>
  <head>
    <title>Multinucleo</title>
  </head>
  <body>
    <canvas></canvas>
    <script>
      let lienzo = document.querySelector("canvas");
      lienzo.width = 4000;
      lienzo.height = 6000;
      let contexto = lienzo.getContext("2d");
      
      let imagen = new Image()
      imagen.src = "josevicente.jpg";
      
      imagen.onload = function(){
        contexto.drawImage(imagen,0,0);
        
        let trabajador1 = new Worker("procesaimagen.js");
        let trabajador2 = new Worker("procesaimagen.js");
        let trabajador3 = new Worker("procesaimagen.js");
        let trabajador4 = new Worker("procesaimagen.js");
        let trabajador5 = new Worker("procesaimagen.js");
        let trabajador6 = new Worker("procesaimagen.js");
        
        let trozo1 = contexto.getImageData(0,0,4000,1000).data; // Cojo el trozo de arriba
        trabajador1.postMessage(trozo1)                 // Al trabajador 1 le envio informacion
        
        trabajador1.onmessage = function(datos){
          console.log(datos.data)
          let origen = contexto.getImageData(0,0,4000,1000)
          for(let i = 0;i<origen.data.length;i+=4){
            origen.data[i] = datos.data[i]
            origen.data[i+1] = datos.data[i+1]
            origen.data[i+2] = datos.data[i+2]
          }
          contexto.putImageData(origen,0,0)
        }
      }
      
    </script>
  </body>
</html>
